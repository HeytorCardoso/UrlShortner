<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encurtador de URL - Sucesso</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{url_for('static', filename='js/main.js')}}" defer></script>
</head>
<body>
    <div class="back-frame">
        <div class="container">
            <form method="POST" class="main-frame" id="urlForm">
                <div class="icon-container">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                </div>
                <h1 class="title">Encurtador de URL</h1>
                <p class="description">Transforme suas URLs longas em links menores</p>
                
                <div class="input-container">
                    <input 
                        id="urlInput" 
                        type="text" 
                        class="input" 
                        placeholder="Paste your URL here (e.g., chatgpt.com)" 
                        name="urlForm"
                        required
                    >
                    <span class="error-message" id="errorMessage"></span>
                </div>
                
                <button type="submit" class="submit-button">
                    <span>URL Encurtada</span>
                    <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <div class="popup-overlay" id="popupOverlay">
        <div class="popup" id="popup">
            <div class="popup-header">
                <div class="success-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <h2 class="popup-title">Sua URL foi encurtada com sucesso!</h2>
                <p class="popup-subtitle">Copie e compartilhe sua nova URL</p>
            </div>
            
            <div class="url-container">
                <div class="input-group">
                    <input 
                        type="text" 
                        id="shortUrlText" 
                        class="short-url-input" 
                        value="https://urlshortner-heytorcardoso.squareweb.app/{{short_url}}" 
                        readonly
                    >
                    <button type="button" class="copy-btn" onclick="copyToClipboard()">
                        <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span class="copy-text">Copiar!</span>
                    </button>
                </div>
            </div>
            
            <div class="popup-actions">
                <button type="button" class="close-button" onclick="window.location.href='{{ url_for('home') }}'">
                    Encurtar Outra
                </button>
            </div>
        </div>
        <footer class="footer">
            <p>Desenvolvido por Heytor Cardoso</p>
        </footer>
    </div>
    

    <script>

        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('popupOverlay').classList.add('show');
            document.getElementById('popup').classList.add('show');
        });

        const form = document.getElementById('urlForm');
        const urlInput = document.getElementById('urlInput');
        const errorMessage = document.getElementById('errorMessage');

        if (form) {
            form.addEventListener('submit', function(e) {
                let url = urlInput.value.trim();
                
                if (!url) {
                    e.preventDefault();
                    showError('Please enter a URL');
                    return false;
                }
                
                if (!url.match(/^https?:\/\//i)) {
                    url = 'https://' + url;
                }
                
                const urlPattern = /^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/;
                
                if (!urlPattern.test(url)) {
                    e.preventDefault();
                    showError('Please enter a valid URL (e.g., chatgpt.com)');
                    return false;
                }
                
                urlInput.value = url;
                hideError();
            });

            urlInput.addEventListener('input', function() {
                hideError();
            });
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            urlInput.classList.add('error');
        }

        function hideError() {
            errorMessage.style.display = 'none';
            urlInput.classList.remove('error');
        }
    </script>
</body>
</html>
